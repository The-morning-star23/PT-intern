datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// --- AUTHENTICATION MODELS (NextAuth Standard) ---

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  role          String    @default("PATIENT") // PATIENT or DOCTOR
  
  accounts      Account[]
  sessions      Session[]

  // Profiles
  doctor        Doctor?
  patient       Patient?  // New: Dedicated profile for Patient specific data

  createdAt     DateTime  @default(now())
}

model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String? @db.Text
  access_token       String? @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String? @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// --- CORE BUSINESS MODELS ---

model Doctor {
  id               String         @id @default(cuid())
  userId           String         @unique
  user             User           @relation(fields: [userId], references: [id])
  
  specialization   String
  licenseNumber    String?        @unique
  experienceYears  Int?
  bio              String?        @db.Text
  hospitalName     String?
  consultationFee  Float?
  education        String?
  languages        String[]
  rating           Float          @default(0.0)
  isVerified       Boolean        @default(false)
  
  // NEW FIELDS to reach 20
  clinicAddress    String?
  city             String?
  state            String?
  zipCode          String?
  consultationType String         @default("PHYSICAL") // VIRTUAL, PHYSICAL, BOTH
  phone            String?
  achievements     String?        @db.Text
  profileStatus    String         @default("PENDING") // ACTIVE, PENDING, INACTIVE

  availabilities   Availability[]
  appointments     Appointment[]
}

model Patient {
  id               String   @id @default(cuid())
  userId           String   @unique
  user             User     @relation(fields: [userId], references: [id])

  phoneNumber      String?
  dateOfBirth      DateTime?
  gender           String?
  bloodGroup       String?
  address          String?
  emergencyContact String?
  allergies        String?
  medicalHistory   String?  @db.Text
  weight           Float?
  height           Float?
  
  // NEW FIELDS to reach 18
  occupation       String?
  maritalStatus    String?
  smokingStatus    Boolean  @default(false)
  alcoholStatus    Boolean  @default(false)
  chronicConditions String?
  insuranceProvider String?
  insuranceNumber  String?
  preferredLanguage String  @default("English")

  appointments     Appointment[]
}

model Availability {
  id        String @id @default(cuid())
  doctorId  String
  doctor    Doctor @relation(fields: [doctorId], references: [id])
  dayOfWeek Int    // 0 (Sun) to 6 (Sat)
  startTime String 
  endTime   String 
  type      String @default("STREAM") 
}

model Appointment {
  id          String   @id @default(cuid())
  doctorId    String
  patientId   String
  
  doctor      Doctor   @relation(fields: [doctorId], references: [id])
  patient     Patient  @relation(fields: [patientId], references: [id]) // Updated to point to Patient model
  
  startTime   DateTime
  endTime     DateTime
  status      String   @default("BOOKED") 
  familyCount Int      @default(1) 
}